function Operator(a){(this.operator=a)||console.log("Operator has no input.");this.solve=function(a,c,h){var n=a.coefficient;"variable"==a.type&&(n=h);a=c.coefficient;"variable"==c.type&&(a=h);if("+"==this.operator)return new Segment(n+a);if("-"==this.operator)return new Segment(n-a);if("*"==this.operator)return new Segment(n*a);if("/"==this.operator)return new Segment(n/a);if("^"==this.operator)return new Segment(Math.pow(n,a))}}
function MathFunction(a){(this.f=a)||console.log("Math function has no input.");this.solve=function(a){a=a.coefficient;if("sin"==this.f)return new Segment(Math.sin(a));if("cos"==this.f)return new Segment(Math.cos(a));if("tan"==this.f)return new Segment(Math.tan(a));if("asin"==this.f)return new Segment(Math.asin(a));if("acos"==this.f)return new Segment(Math.acos(a));if("atan"==this.f)return new Segment(Math.atan(a));if("abs"==this.f)return new Segment(Math.abs(a))}}
function Segment(a){this.sections=[];this.type="section";this.mathFunction=this.coefficient=this.operator=0;this.variable="";var m=function(a){if(!a)return"";for(;"("==a.substr(0,1)&&")"==a.substr(a.length-1,1);){for(var b=1,k=1;k<a.length&&0<b;k++)"("==a.substr(k,1)&&b++,")"==a.substr(k,1)&&b--;k-=1;if(0!==b||k!=a.length-1)break;else a=a.substring(1,a.length-1)}return a},c=function(a,b){for(var k=!0,d=-1,d="^"!=a?b.lastIndexOf(a):b.indexOf(a);k;){for(var e=0,t=0;t<b.length;t++)if("("==b.substr(t,
1)?e++:")"==b.substr(t,1)&&e--,t==d)if(0===e&&("-"!=a||0<t&&-1=="+-/*^".indexOf(b.substr(t-1,1))||0===t)||1==e&&"("==a){k=!1;break}else d="^"!=a?b.substring(0,d).lastIndexOf(a):-1==b.substring(d+1).indexOf(a)?-1:d+1+b.substring(d+1).indexOf(a);-1==d&&(k=!1)}return d},h=function(a,b){var k=0,d=-1,e=0;if("sin"==a)e=/(a)?sin/g;else if("cos"==a)e=/(a)?cos/g;else if("tan"==a)e=/(a)?tan/g;else return-1;for(k=e.exec(b);k;k=e.exec(b))"a"!=RegExp.$1&&(d=k.index);for(var t=!0;t&&-1!=d;){for(var c=0,f=0;f<b.length;f++)if("("==
b.substr(f,1)?c++:")"==b.substr(f,1)&&c--,f==d)if(0===c){t=!1;break}else for(var g=b.substring(0,d),d=-1,k=e.exec(g);k;k=e.exec(g))"a"!=RegExp.$1&&(d=k.index);-1==d&&(t=!1)}return d},n=function(a){for(var b=!0,k=!0,d=-1,e=-1,d=a.lastIndexOf("("),e=a.lastIndexOf(")");b||k;){for(var t=0,c=0;c<a.length;c++)"("==a.substr(c,1)?t++:")"==a.substr(c,1)&&t--,c==d&&b&&(1==t&&0!==c&&-1=="+-/*^sincostanabs".indexOf(a.substr(c-1,1))?b=!1:d=a.substring(0,d).lastIndexOf("(")),c==e&&k&&(0===t&&c<a.length-1&&-1==
"+-/*^sincostanabs".indexOf(a.substr(c+1,1))?k=!1:e=a.substring(0,e).lastIndexOf(")"));-1==d&&(b=!1);-1==e&&(k=!1)}return e>d&&-1!=e?e:d};this.solve=function(a){a||(a=0);if("value"==this.type)return this;if("variable"==this.type)return new Segment(a);if("function"==this.type)return this.mathFunction.solve(this.sections[0].solve(a));if(1==this.sections.length)return this.sections[0].solve(a);if(2==this.sections.length)return this.operator.solve(this.sections[0].solve(a),this.sections[1].solve(a),a)};
this.result=function(a){return this.solve(a).coefficient};this.display=function(a){if("value"==this.type)return this.coefficient;if("variable"==this.type)return"x";if("function"==this.type)return this.mathFunction.f;for(var b="<div class='group'>",k=0;k<this.sections.length;k++)b+=this.sections[k].display(a),0===k&&this.operator&&(b+="<div class='group operator'>"+this.operator.operator+"</div>");b+="<div class='answer'>= "+this.solve().coefficient+"</div>";return b+"</div>"};if(void 0!==a)if("string"==
typeof a){a=a.replace(/\s/g,"");a=m(a);var q=c("+",a),l=c("-",a),f=c("/",a),b=c("^",a),m=c("(",a),w=h("sin",a),x=h("cos",a),h=h("tan",a),r=c("asin",a),u=c("acos",a),s=c("atan",a),p=c("abs",a),c=c("*",a),n=n(a),v=-1;w>c&&(v=w);x>c&&(v=x);h>c&&(v=h);r>c&&(v=r);u>c&&(v=u);s>c&&(v=s);p>c&&(v=p);if(-1!=q&&(-1==l||q>l))this.sections.push(new Segment(a.substring(0,q))),this.sections.push(new Segment(a.substring(q+1))),this.operator=new Operator("+");else if(-1!=l)0<l?this.sections.push(new Segment(a.substring(0,
l))):this.sections.push(new Segment(0)),this.sections.push(new Segment(a.substring(l+1))),this.operator=new Operator("-");else if(0<v&&v>c&&v>f)this.sections.push(new Segment(a.substring(0,v))),this.sections.push(new Segment(a.substring(v))),this.operator=new Operator("*");else if(-1!=n&&(-1==f||c>f)&&(-1==c||n>c))this.sections.push(new Segment(a.substring(0,n))),this.sections.push(new Segment(a.substring(n))),this.operator=new Operator("*");else if(-1!=c&&(-1==f||c>f))this.sections.push(new Segment(a.substring(0,
c))),this.sections.push(new Segment(a.substring(c+1))),this.operator=new Operator("*");else if(-1!=f)this.sections.push(new Segment(a.substring(0,f))),this.sections.push(new Segment(a.substring(f+1))),this.operator=new Operator("/");else if(-1!=b)this.sections.push(new Segment(a.substring(0,b))),this.sections.push(new Segment(a.substring(b+1))),this.operator=new Operator("^");else if(-1!=w&&(-1==x||w>x)&&(-1==h||w>h)&&(-1==r||w>r)&&(-1==u||w>u)&&(-1==s||w>s)&&(-1==p||w>p))this.sections.push(new Segment(a.substring(w+
3))),this.mathFunction=new MathFunction("sin"),this.type="function";else if(-1!=x&&(-1==h||x>h)&&(-1==r||x>r)&&(-1==u||x>u)&&(-1==s||x>s)&&(-1==p||x>p))this.sections.push(new Segment(a.substring(x+3))),this.mathFunction=new MathFunction("cos"),this.type="function";else if(-1!=h&&(-1==r||h>r)&&(-1==u||h>u)&&(-1==s||h>s)&&(-1==p||h>p))this.sections.push(new Segment(a.substring(h+3))),this.mathFunction=new MathFunction("tan"),this.type="function";else if(-1!=r&&(-1==u||r>u)&&(-1==s||r>s)&&(-1==p||r>
p))this.sections.push(new Segment(a.substring(r+4))),this.mathFunction=new MathFunction("asin"),this.type="function";else if(-1!=u&&(-1==s||u>s)&&(-1==p||u>p))this.sections.push(new Segment(a.substring(u+4))),this.mathFunction=new MathFunction("acos"),this.type="function";else if(-1!=s&&(-1==p||s>p))this.sections.push(new Segment(a.substring(s+4))),this.mathFunction=new MathFunction("atan"),this.type="function";else if(-1!=p)this.sections.push(new Segment(a.substring(p+3))),this.mathFunction=new MathFunction("abs"),
this.type="function";else if(-1!=m){q=1;for(l=m+1;l<a.length&&0<q;l++)"("==a.substr(l,1)&&q++,")"==a.substr(l,1)&&q--;0===q?(q=l-1,0<m&&this.sections.push(new Segment(a.substring(0,m))),1!=q-m&&this.sections.push(new Segment(a.substring(m+1,q))),q!=a.length-1&&this.sections.push(new Segment(a.substring(q+1))),this.operator=new Operator("*")):console.log("Brackets nesting error: "+a)}else m=a.toLowerCase().indexOf("x"),-1!=m?0<m?(this.sections.push(new Segment(a.substring(0,m))),this.sections.push(new Segment("x")),
this.operator=new Operator("*")):(this.variable="x",this.type="variable"):(this.coefficient=parseFloat(a),this.type="value")}else"number"==typeof a&&(this.coefficient=a,this.type="value");else console.log("Segment has no input.")}function Point(a,m){this.x=a||0;this.y=m||0}
function Graph(a,m,c,h,n){var q=!1;void 0===h&&(h=10);void 0===n&&(q=!0);this.expression=new Segment(a);this.points=[];this.canvas=document.createElement("canvas");this.canvas.width=m||400;this.canvas.height=c||400;this.max=this.min=void 0;this.x1=0-Math.abs(h);this.x2=0+Math.abs(h);this.y1=0-Math.abs(n);this.y2=0+Math.abs(n);var l=new Point(0,0),f=new Point(0,0),b=0,w=0;this.getMin=function(){if(void 0===this.min){if(0<this.points.length){for(var a=this.points[0].y,b=1;b<this.points.length;b++)this.points[b].y<
a&&(a=this.points[b].y);return this.min=a}return 0}return this.min};this.getMax=function(){if(void 0===this.max){if(0<this.points.length){for(var a=this.points[0].y,b=1;b<this.points.length;b++)this.points[b].y>a&&(a=this.points[b].y);return this.max=a}return 0}return this.max};this.update=function(){var a=(this.x2-this.x1)/this.canvas.width;this.points=[];for(var b=this.x1;b<=this.x2;b+=a)this.points.push(new Point(b,this.expression.result(b)));q&&(1E5<this.getMax()-this.getMin()?(this.y1=-100,this.y2=
100):(this.y1=this.getMin()-5,this.y2=this.getMax()+5),q=!1);Math.ceil(Math.log(this.x2-this.x1));Math.ceil(Math.log(this.y2-this.y1));this.redraw()};var x=function(a,d,e,c,f){b.strokeStyle="#bdc3c7";b.fillStyle="#bdc3c7";var h=0,g=0;if(0>=a-30&&0<=d+30)for(b.lineWidth=2,b.beginPath(),b.moveTo(this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width,0),b.lineTo(this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width,this.canvas.height),b.closePath(),b.stroke(),b.textAlign="right",b.textBaseline="middle",b.lineWidth=
1,h=Math.abs(c)>Math.abs(e)?Math.abs(c):Math.abs(e),g=0;g<=h;g+=Math.pow(10,Math.floor(Math.log(c-e)/Math.LN10))/4)0!==g&&(g<=c+50&&(f||g>=this.y2-50)&&(b.beginPath(),b.moveTo(this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width-5,this.canvas.height-(g-e)/(c-e)*this.canvas.height),b.lineTo(this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width+5,this.canvas.height-(g-e)/(c-e)*this.canvas.height),b.closePath(),b.stroke(),b.fillText(""+Math.round(100*g)/100,this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width-
8,this.canvas.height-(g-e)/(c-e)*this.canvas.height)),g>=e-50&&(f||-g<=this.y1+50)&&(b.beginPath(),b.moveTo(this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width-5,this.canvas.height-(-g-e)/(c-e)*this.canvas.height),b.lineTo(this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width+5,this.canvas.height-(-g-e)/(c-e)*this.canvas.height),b.closePath(),b.stroke(),b.fillText(""+Math.round(100*-g)/100,this.canvas.width/2-(d+a)/2/(d-a)*this.canvas.width-8,this.canvas.height-(-g-e)/(c-e)*this.canvas.height)));if(0>=
e-50&&0<=c+50)for(b.lineWidth=2,b.beginPath(),b.moveTo(0,this.canvas.height/2+(c+e)/2/(c-e)*this.canvas.height),b.lineTo(this.canvas.width,this.canvas.height/2+(c+e)/2/(c-e)*this.canvas.height),b.closePath(),b.stroke(),b.textAlign="center",b.textBaseline="top",b.lineWidth=1,h=Math.abs(d)>Math.abs(a)?Math.abs(d):Math.abs(a),g=0;g<=h;g+=Math.pow(10,Math.floor(Math.log(d-a)/Math.LN10))/4)0!==g&&(g<=d+50&&(f||g>=this.x2-50)&&(b.beginPath(),b.moveTo((g-a)/(d-a)*this.canvas.width,this.canvas.height/2+(c+
e)/2/(c-e)*this.canvas.height-5),b.lineTo((g-a)/(d-a)*this.canvas.width,this.canvas.height/2+(c+e)/2/(c-e)*this.canvas.height+5),b.closePath(),b.stroke(),b.fillText(""+Math.round(100*g)/100,(g-a)/(d-a)*this.canvas.width,this.canvas.height/2+(c+e)/2/(c-e)*this.canvas.height+8)),g>=a-50&&(f||-g<=this.x1+50)&&(b.beginPath(),b.moveTo((-g-a)/(d-a)*this.canvas.width,this.canvas.height/2+(c+e)/2/(c-e)*this.canvas.height-5),b.lineTo((-g-a)/(d-a)*this.canvas.width,this.canvas.height/2+(c+e)/2/(c-e)*this.canvas.height+
5),b.closePath(),b.stroke(),b.fillText(""+Math.round(100*-g)/100,(-g-a)/(d-a)*this.canvas.width,this.canvas.height/2+(c+e)/2/(c-e)*this.canvas.height+8)))}.bind(this);this.redraw=function(){if(1<this.points.length){b.clearRect(0,0,this.canvas.width,this.canvas.height);b.lineCap="round";var a=-this.y1;x(this.x1,this.x2,this.y1,this.y2,!0);b.strokeStyle="#2980b9";b.lineWidth=1;b.beginPath();b.moveTo(0,this.canvas.height-(this.points[0].y+a)/(this.y2-this.y1)*this.canvas.height);for(var d=1;d<this.points.length;d++)Math.abs(this.canvas.height-
(this.points[d].y+a)/(this.y2-this.y1)*this.canvas.height-(this.canvas.height-(this.points[d-1].y+a)/(this.y2-this.y1)*this.canvas.height))<=this.canvas.height&&b.lineTo(d/this.points.length*this.canvas.width,this.canvas.height-(this.points[d].y+a)/(this.y2-this.y1)*this.canvas.height),b.moveTo(d/this.points.length*this.canvas.width,this.canvas.height-(this.points[d].y+a)/(this.y2-this.y1)*this.canvas.height);b.closePath();b.stroke();w=b.getImageData(0,0,this.canvas.width,this.canvas.height)}else console.log("Not enough points to graph.")};
this.setRange=function(a,b,c,f){this.x1=a;this.x2=b;this.y1=c;this.y2=f;this.update()};var r=function(a){var b=this.canvas.getBoundingClientRect(),c=document.documentElement;return new Point(a.clientX-b.left-c.scrollLeft,a.clientY-b.top-c.scrollTop)}.bind(this);a=function(a){document.addEventListener("mousemove",s,!1);document.addEventListener("mouseup",p,!1);this.canvas.removeEventListener("mouseover",v,!1);this.canvas.removeEventListener("mousemove",y,!1);l=r(a)}.bind(this);var u=function(){var a=
(f.x-l.x)/this.canvas.width*(this.x2-this.x1),b=(f.y-l.y)/this.canvas.height*(this.y2-this.y1);this.setRange(this.x1-a,this.x2-a,this.y1+b,this.y2+b);l=f}.bind(this),s=function(a){b.clearRect(0,0,this.canvas.width,this.canvas.height);f=r(a);a=this.x1-(f.x-l.x)/this.canvas.width*(this.x2-this.x1);var c=this.y1+(f.y-l.y)/this.canvas.height*(this.y2-this.y1);x(a,this.x2-(f.x-l.x)/this.canvas.width*(this.x2-this.x1),c,this.y2+(f.y-l.y)/this.canvas.height*(this.y2-this.y1),!1);b.putImageData(w,f.x-l.x,
f.y-l.y);(Math.abs(a-this.x1)>this.canvas.width/2||Math.abs(c-this.y1)>this.canvas.height/2)&&setTimeout(u,100)}.bind(this),p=function(a){document.removeEventListener("mousemove",s,!1);document.removeEventListener("mouseup",p,!1);this.canvas.addEventListener("mouseover",v,!1);this.canvas.addEventListener("mousemove",y,!1);f=r(a);a=(f.x-l.x)/this.canvas.width*(this.x2-this.x1);var b=(f.y-l.y)/this.canvas.height*(this.y2-this.y1);this.setRange(this.x1-a,this.x2-a,this.y1+b,this.y2+b)}.bind(this),v=
function(a){this.canvas.addEventListener("mousemove",y,!1);this.canvas.addEventListener("mouseout",z,!1)}.bind(this),y=function(a){b.clearRect(0,0,this.canvas.width,this.canvas.height);b.putImageData(w,0,0);f=r(a);a=-this.y1;b.fillStyle="#2980b9";b.beginPath();b.arc(f.x,this.canvas.height-(this.points[Math.round(f.x/this.canvas.width*this.points.length)].y+a)/(this.y2-this.y1)*this.canvas.height,4,0,2*Math.PI);b.closePath();b.fill();b.fillStyle="#000";b.strokeStyle="#FFF";b.lineWidth=4;b.textBaseline=
"alphabetic";var c="("+(Math.round(100*this.points[Math.round(f.x/this.canvas.width*this.points.length)].x)/100).toFixed(2)+", "+(Math.round(100*this.points[Math.round(f.x/this.canvas.width*this.points.length)].y)/100).toFixed(2)+")";f.x<b.measureText(c).width/2+2?b.textAlign="left":f.x>this.canvas.width-b.measureText(c).width/2-2?b.textAlign="right":b.textAlign="center";b.strokeText(c,f.x,-10+this.canvas.height-(this.points[Math.round(f.x/this.canvas.width*this.points.length)].y+a)/(this.y2-this.y1)*
this.canvas.height);b.fillText(c,f.x,-10+this.canvas.height-(this.points[Math.round(f.x/this.canvas.width*this.points.length)].y+a)/(this.y2-this.y1)*this.canvas.height)}.bind(this),z=function(a){this.canvas.removeEventListener("mousemove",y,!1);this.canvas.removeEventListener("mouseout",z,!1);b.clearRect(0,0,this.canvas.width,this.canvas.height);b.putImageData(w,0,0)}.bind(this);this.getCanvas=function(){return this.canvas};this.canvas.getContext?(b=this.canvas.getContext("2d"),b.font="12px sans-serif",
this.canvas.style.backgroundColor="#FFF",this.update(),this.canvas.addEventListener("mousedown",a,!1),this.canvas.addEventListener("mouseover",v,!1)):(console.log("Canvas not supported in this browser."),this.canvas=document.createElement("div"),this.canvas.innerHTML="Canvas is not supported in this browser.")}
var XCalc=function(){return{properBrackets:function(a){for(var m=0,c=0;c<a.length;c++)"("==a.substr(c,1)&&m++,")"==a.substr(c,1)&&m--;return 0===m},createExpression:function(a){return this.properBrackets(a)?new Segment(a):0},graphExpression:function(a,m,c,h,n){return new Graph(a,m,c,h,n)}}}();
